---
title: "Peak flow locs for Northwestern Great Plains and High Plains ecoregion"
author: "CJ Tinant"
date: "`r Sys.Date()`"
output: html_document
---

```{r 00_setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# library
library(tidyverse)        # Load the 'Tidyverse' packages: ggplot2, dplyr, 
                          #   tidyr, readr, purrr, tibble, stringr, and forcats
library(dataRetrieval)    # Retrieval functions for USGS and EPA hydrology and
                          #   water quality data
library(sf)               # Simple features for R
library(Lmoments)         # L-moments and trimmed L-moments from the data
library(lmom)

```

```{r 01_import_munge_peak-flow_metadata}

# get peakflow metadata
sites_peak <- read_csv("data/sites_peak.csv")

# filter sites greater than 20 years
sites_gt_20 <- sites_peak %>%
  filter(count_nu > 20)

# Identify missing data
sites_gt_20_missing_data <- sites_peak %>%
  summarize(across(everything(), ~sum(is.na(.)))
            ) %>%
  pivot_longer(cols = everything())

```

```{r 02_get_peak-flow_data}

# get peak data
site_ids <- sites_gt_20$site_no

peak_data <- readNWISpeak(site_ids)

peak_data_ck <- peak_data %>%
  group_by(site_no) %>%
  summarise(count = n())

```

```{r 01_remove_years_without_peak_va}

peak_data_na <- peak_data %>%
  filter(is.na(peak_va))

peak_data <- anti_join(peak_data, peak_data_na)

write_csv(peak_data, "data/data_peak.csv")

```

```{r 02_drop_vars}

peak_data <- peak_data %>%
  select(-c(
    agency_cd,
    peak_tm,
    gage_ht,
    gage_ht_cd,
    ag_tm,
    ag_gage_ht,
    ag_gage_ht_cd,
    peak_dateTime,
    ag_dateTime,
    ag_dt,
    year_last_pk
  ))

```

```{r}

moments <- peak_data %>%
  group_by(site_no) %>%
  samlmu(peak_data$peak_va, 4)

  summarise(moments = Lmoments(peak_data$peak_va))


```


<!--
# Ecoregion hierarchy
Northwestern Great Plains and High Plains region of the SOUTH CENTRAL SEMI-ARID PRAIRIES of the GREAT PLAINS ecoregion

## Next steps
create an inline unzip
unzip /path/to/your/file.zip -d /path/to/destination/folder

-- need to add ecoreg when joining

* intersect level 3 ecoregion with station data
* sync personal and group Zotero library for FFA
https://guides.library.oregonstate.edu/c.php?g=359201&p=2426111
https://www.zotero.org/groups/5473862/olc_flood-frequency


## Helpful references:
GIT issues--
[GIT issues](https://dangitgit.com/)

Spatial data issues--
[Intro to spatial data in R](https://www.r4wrds.com/intro/m_intro_mapmaking)
[Overview of Coordinate Reference Systems (CRS) in R](https://www.nceas.ucsb.edu/sites/default/files/2020-04/OverviewCoordinateReferenceSystems.pdf)
[Geocomputation with R](https://r.geocompx.org/)

References:
[dataRetrieval tutorial](https://waterdata.usgs.gov/blog/dataretrieval/)

[USGS watermapper](https://maps.waterdata.usgs.gov/mapper/index.html)
-->






