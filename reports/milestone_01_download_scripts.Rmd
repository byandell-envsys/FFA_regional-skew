---
title: "Milestone 01 ‚Äì Build and Document Download Scripts"
author: "C.J. Tinant"
date: "`r Sys.Date()`"
output: github_document
---

> **Summary:** This milestone initiates modular download scripts for all key domains and covariates (climate, terrain, ecoregion, site metadata). It establishes script naming conventions and sets the foundation for automation of data ingestion and preprocessing.

## Ver.0.4 ‚Äì Update R/01_download

| Step | Task                                                  | Status |
|------|-------------------------------------------------------|--------|
| 1    | Create download scripts for each domain and covariate | [ ]    |
| 2    | Create README-style notes in milestone folder         | [ ]    |
| 3    | Refactor PRISM and terrain downloads                  | [ ]    |
| 4    | Improve site-level metadata integration               | [ ]    |
| 5    | Validate spatial coverage across domains              | [ ]    |
| 6    | Document inputs, outputs, assumptions                 | [ ]    |
| 7    | Add file size / resolution audit to .Rmd              | [ ]    |
| 8    | Commit and tag `v0.4-download-scripts`                | [ ]    |

## Notes

-   This milestone builds on `v0.3-structure-refactor`
-   All scripts will follow: `milestone + domain + covariate + source` naming
-   README-style documentation will be embedded in this .Rmd file for reproducibility


### Spatial Data Preparation Checklist

See [`spatial_data_preparation_checklist.md`](../reports_milestone01_download_scripts/spatial_data_preparation_checklist.md) for a reusable checklist used to guide and document preprocessing steps across spatial layers.

-   Consider moving the checklist as a stand-alone file.

| Step | Task                         | Description                      | [x] |
| ---- | ---------------------------- |--------------------------------- | --- |
| 1    | **Acquire**                  | Download data from trusted source (USGS, PRISM, EPA, etc.)           | ‚òê |
| 2    | **Inspect**                  | Check format, projection, geometry type, extent                      | ‚òê |
| 3    | **Clean**                    | Remove empty, invalid, or duplicate geometries                       | ‚òê |
| 4    | **Reproject**                | Convert all data to a common CRS (e.g., NAD83 / UTM zone)            | ‚òê |
| 5    | **Clip / Mask**              | Clip to study boundary or watershed extent (optional)                | ‚òê |
| 6    | **Filter**                   | Subset by attribute or spatial filter (e.g., perennial streams only) | ‚òê |
| 7    | **Join Attributes**          | Join tabular metadata to spatial features by ID                      | ‚òê |
| 8    | **Spatial Join / Intersect** | Overlay/intersect with other layers (e.g., land cover, ecoregions)   | ‚òê |
| 9    | **Aggregate**                | Summarize to analysis unit (e.g., mean elevation by watershed)       | ‚òê |
| 10   | **Validate**                 | Check geometries, missing values, outliers, CRS alignment            | ‚òê |
| 11   | **Export**                   | Save cleaned files with consistent naming, formats, and CRS          | ‚òê |
| 12   | **Document**                 | Record source, projection, processing steps, and variable notes      | ‚òê |


# Naming Strategy for Acquired (Raw) Spatial Data

## Folder Names

Use:

-   /data_raw/epa_landcover_2021/  

-   /data_raw/usgs_nhdplusv2/  

-   /data_raw/prism_ppt_normals/

## File Name Pattern

[source]_[layer]_[year|version]_[status].[ext]

## Example Filenames

-   prism_ppt_30yrnormals_raw.bil

-   usgs_nhdplus_catchments_v21_raw.shp

-   epa_nlcd_2021_raw.tif

-   census_county_boundaries_2020_raw.gpkg




## Suggested Next Steps

```         
Milestone 01: Download Scripts

.... Look through 01_get_spatial...R

    Begin modular scripts for each covariate domain.

    Optional: log intermediate outputs in data/meta/.

Milestone 02: Documentation

    Start data/meta/data_dictionary.csv

    Add README.md templates to R/ and data/

Plan Milestone 03: {targets} or covariate modeling

    Add a placeholder script to scaffold milestone folders.

    We can build a targets pipeline incrementally if you‚Äôd like.
```

## Longer-term Considerations

### üîÅ Updated Plan Using Use Gage Locations (Filtered by Macrozone)

1.  Assign each gage to a macrozone using st_join():

```         
gages_macrozone <- st_join(gages_sf, macrozone_sf["macrozone"])
```

2.  gages_macrozone \<- st_join(gages_sf, macrozone_sf["macrozone"])

```         
gages_macrozone %>%
  group_by(macrozone) %>%
  summarize(across(where(is.numeric), list(mean = mean, sd = sd), na.rm = TRUE))
```

3.  Model:

    Include macrozone as a categorical fixed or random effect

    Or use it to stratify residuals, fit regional models, etc.

Bonus: You Can Still Use Polygons

Even though you're using gages:

```         
You can visualize macrozones as basemap groups

Or compute zone-wide summaries for supporting tables or EDA
```

üß≠ Bottom Line

You‚Äôre right to go with Use Gage Locations (Filtered by Macrozone) ‚Äî it's more robust, interpretable, and directly connected to your outcome variable (station skew). Random samples are useful for some exploratory summaries, but not essential here.

## üå± When You‚Äôre Ready to Grow Again‚Ä¶

Here are next-step seeds you might plant: 1. Finalize Milestone 01

```         
Get gage locations, climate normals, and terrain data into shape

Join covariates to each gage (with macrozone as a group)
```

2.  Begin Milestone 03 (Targets or Modeling)

    Start small: just one covariate, one model

    Or set up a {targets} pipeline to wrap download ‚Üí clean ‚Üí model

3.  Open a Future Milestone Planning Doc

You've already created notes/future_milestones.Rmd ‚Äî that‚Äôs your strategic launchpad.
