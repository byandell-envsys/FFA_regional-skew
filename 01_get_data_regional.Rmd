---
title: "Get peak flow data for Northwestern Great Plains ecoregion gages"
author: "CJ Tinant"
date: "`r Sys.Date()`"
output: html_document
---

<!--

--> 

```{r 00_setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# library
library(tidyverse)        # Load the 'Tidyverse' packages: ggplot2, dplyr, 
                          #   tidyr, readr, purrr, tibble, stringr, and forcats
library(dataRetrieval)    # Retrieval functions for USGS and EPA hydrology and
                          #   water quality data
library(sf)               # Simple features for R
library(here)             # A simpler way to find files

```

```{r 01_find_sites_north-GP}

# watermapper for visualization
# https://maps.waterdata.usgs.gov/mapper/index.html

# Northern Great Plains--
#  west  south  east  north
# -111.5, 42.0, -99.5, 48.5

# get a list of sites for the Northwestern Great Plains ecoregion bounding box
sites_nw <- whatNWISsites(                       
  bBox = c(-111.5, 45.0, -105.5, 48.5)           #  west  south  east  north
  )

sites_sw <- whatNWISsites(                       
  bBox = c(-111.5, 42.0, -105.5, 45.0)           #  west  south  east  north
  )

sites_ne <- whatNWISsites(                       
  bBox = c(-105.5, 45.0, -99.5, 48.5)            #  west  south  east  north
  )

sites_se <- whatNWISsites(                       
  bBox = c(-105.5, 42.0, -99.5, 45.0)            #  west  south  east  north
  )

# bind rows -- filter stream gages
sites_ngp <- bind_rows(sites_nw, sites_sw, sites_ne, sites_se) %>%
  filter(site_tp_cd == "ST")

# get a list of all peak flow data in bounding box -- add ecoreg
peak_ngp <-  whatNWISdata(
  siteNumber = sites_ngp$site_no,
  service = "pk"
  ) %>%
  mutate(ecoreg = "ngp")

# High Plains

#  west  south  east  north
# -105.6, 31.0, -100, 42.0

# get a list of sites for the High Plains ecoregion bounding box
sites_nw <- whatNWISsites(                       
  bBox = c(-105.6, 37.5, -102.8, 42.0)           #  west  south  east  north
  )

sites_sw <- whatNWISsites(                       
  bBox = c(-105.6, 31.0, -102.8, 37.5)           #  west  south  east  north
  )

sites_ne <- whatNWISsites(                       
  bBox = c(-102.8, 37.5, -100, 42.0)             #  west  south  east  north
  )

sites_se <- whatNWISsites(                       
  bBox = c(-102.8, 31.0, -100, 37.5)             #  west  south  east  north
  )

# bind rows -- filter stream gages
sites_hp <- bind_rows(sites_nw, sites_sw, sites_ne, sites_se) %>%
  filter(site_tp_cd == "ST")

# get a list of all peak flow data in bounding box -- add ecoreg
peak_hp <-  whatNWISdata(
  siteNumber = sites_hp$site_no,
  service = "pk"
  ) %>%
  mutate(ecoreg = "hp")

# bind cols and export
sites_peak <- bind_rows(peak_ngp, peak_hp)

write_csv(sites_peak, "data/sites_peak.csv")

# clean up Global Environment
rm(list = ls(pattern = "sites"))

```

```{r 02_dl_shapefiles}

# download shapefiles by calling the download.file() function, and passing 
#   in the URL and file name/location as arguments

# location where you want to save the file on your computer after here()
file_path <- "data_spatial"

# level-3 ecoregion download--
# URL of the file to download and file name save on your computer
url       <- "https://gaftp.epa.gov/EPADataCommons/ORD/Ecoregions/us/us_eco_l3.zip"
file_name <- "us_eco_l3.zip"

download.file(url, paste(file_path, file_name, sep = ""))

# level-4 ecoregion download
# URL of the file to download and file name save on your computer
url <- "https://gaftp.epa.gov/EPADataCommons/ORD/Ecoregions/us/us_eco_l4.zip"
file_name <- "us_eco_l4.zip"

download.file(url, paste(file_path, file_name, sep = ""))

# 2023 USDA Plant Hardiness Zone GIS Datasets
#   https://prism.oregonstate.edu/projects/plant_hardiness_zones.php

# shapefile
url <- "https://prism.oregonstate.edu/projects/phm_data/phzm_us_zones_shp_2023.zip"
file_name <- "phzm_us_zones_shp_2023.zip"

# GRID data
url <- "https://prism.oregonstate.edu/projects/phm_data/phzm_us_grid_2023.zip"
file_name <- "phzm_us_grid_2023.zip"

# State boundary download
#   https://www.sciencebase.gov/catalog/item/52c78623e4b060b9ebca5be5
url <- "http://www2.census.gov/geo/tiger/TIGER2012/STATE/tl_2012_us_state.zip"
file_name <- "tl_2012_us_state.zip"

```



