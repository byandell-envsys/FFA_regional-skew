---
title: "README – FFA Regional Skew Estimation"
output: 
  github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(tidyverse)
library(knitr)


```


# Project Description
## Overview

This project supports the estimation of regional skew coefficients for flood frequency analysis in the Great Plains. It emphasizes reproducibility, modular data workflows, and the integration of spatial and climatic covariates.

The workflow uses R and {tidyverse} tools to automate the download, cleaning, joining, and modeling of covariate data associated with gage locations. Covariates include climate normals, terrain characteristics, and site location variables. 

## Goals and Objective

The primary goal of this phase is to explain spatial variation in station skew — the log-Pearson Type III skew coefficient estimated at individual stream gages — using a set of numeric covariates derived from data related to: Ecological Regions (Ecoregions), Location, Climate, Topography, Watershed Characteristics, Land Cover Characteristics.

## Layout of Analysis

I adopted a multi-scale hierarchical framework with variables organized by spatial scale and domain (below). The largest spatial scale is a custom macroregion based on prairie grassland type, which was derived from Level II Ecoregions. Other spatial scales include a regional scale at the Level II Ecoregion extent, a subregional scale at the Level III Ecoregion extent, and a local catchment level scale at the NHD+ extent (Figure 2).


```{r gp_variable_scaffold, echo=FALSE, results='asis'}

variable_count <- tibble::tribble(
  ~Scale, ~Extent, ~Climate, ~`Land Cover`, ~Topography, ~Watershed, ~Total,
  "Macroregional", "Custom Macrozone", 3, 4, 3, 3, 13,
  "Regional", "Level II Ecoregion", 4, 4, 4, 5, 17, 
  "Subregional", "Level III Ecoregion", 6, 2, 4, 3, 15, 
  "Local", "NHD+ catchments", 3, 2, 8, 4, 17
)

knitr::kable(variable_count, caption = "Table: Variable Count")
```

```{r gp_variable_scaffold2, echo=FALSE, results='asis'}

hierarchical_variables <- tibble::tibble(
# Macroregional x 6, then Regional x 6, ...
    scale = c(
    rep("Macroregional", 6),
    rep("Regional", 6),
    rep("Subregional (Level III)", 6),
    rep("Local (Level IV / catchments)", 6)
  ),
# Each of the domain vars listed x 4
  domain = rep(c("Ecoregion", "Location", "Climate", "Topography", "Watershed", "Land Cover"), 4),
  variable = c(
    # Macro-regional
    "Great Plains macrozone (e.g., tallgrass, shortgrass, semiarid)",
    "Gage locations",
    "Regional climate PC1–PC2 (or Köppen subtype)",
    "Mean elevation, broad slope",
    "Mean basin area per macrozone",
    "Dominant vegetation / NLCD cover class",

    # Regional
    "Level II ecoregion (9.2–9.6)",
    "Regional centroid or HUC4 region",
    "Seasonal precip/temp normals, precipitation regime (e.g., monsoon index)",
    "Slope distribution (e.g., % flat, % steep)",
    "Stream density, average flow length",
    "Seasonal NDVI or cover change metrics",

    # Subregional
    "Level III ecoregion",
    "Station-specific coordinates",
    "Monthly precip/temp normals, Köppen subtype",
    "Topo roughness, elev range, TWI",
    "NHD+ catchment metrics (e.g., area, stream order)",
    "Land use diversity index (Shannon, Simpson)",

    # Local
    "Level IV ecoregion",
    "Site and catchment spatial footprint",
    "Submonthly anomalies, snowmelt indicators",
    "Curvature, slope aspect, local ruggedness",
    "Local runoff potential or soil permeability",
    "MODIS land cover diversity (TBD)"
  ),
  type = c(
    "categorical", "spatial", "numeric / categorical", "numeric", "numeric", "categorical",
    "categorical", "spatial", "numeric", "numeric", "numeric", "numeric",
    "categorical", "numeric", "numeric / categorical", "numeric", "numeric", "numeric",
    "categorical", "spatial", "numeric", "numeric", "numeric", "categorical"
  ),
  source_dataset = c(
    # Macro-regional
    "Custom classification from Level II ecoregion",
    "Derived from ecoregion shapefiles",
    "PRISM / WorldClim / Köppen maps",
    "NED / DEM elevation raster",
    "Derived from basin shapefiles or NHD+",
    "NLCD (National Land Cover Database)",

    # Regional
    "EPA Level II ecoregions",
    "USGS Watershed Boundaries / HUC4",
    "PRISM climate normals",
    "Derived from elevation (NED) or slope raster",
    "NHD+ flowlines or catchment shapefiles",
    "MODIS NDVI or seasonal land cover",

    # Subregional
    "EPA Level III ecoregions",
    "Gage lat/lon from NWIS",
    "PRISM monthly normals / Köppen subtypes",
    "DEM-derived terrain metrics (TWI, roughness)",
    "NHD+ catchment summary table",
    "Calculated from NLCD or MODIS classifications",

    # Local
    "EPA Level IV ecoregions",
    "Catchment or HUC12 boundary polygons",
    "PRISM or downscaled model products",
    "Terrain analysis (curvature, aspect)",
    "SSURGO / STATSGO soils or DEM runoff index",
    "MODIS / NLCD land cover composition"
  ))


knitr::kable(hierarchical_variables, caption = "Table: Hierarchical Variable Scaffold for Skew Modeling in the Great Plains")
```

```{r}

source_data <- hierarchical_variables %>%
  select(source_dataset)

```



## Project Milestones

Current version: v0.3 – Refactored Project Structure
See [milestone_00_project_structure_refact.Rmd](reports/milestone_00_project_structure_refact.Rmd) for detailed changelog.

------------------------------------------------------------------------

## Project Structure (as of v0.3)

```
FFA_regional-skew/ 
├── R/01_download/              # Raw data scripts (e.g., NWIS, PRISM) 
├── R/02_clean/                 # QA/QC and filtering 
├── R/03_covariates/            # Covariate derivation (e.g., climate, terrain) 
├── R/04_modeling/              # Elastic Net, GAMs 
├── R/05_eval/                  # Model validation 
├── R/utils/                    # Shared helper functions 
├── data/
│ ├── data/meta/                # metadata on original data
│ ├── data/raw/                 # Original shapefiles, PRISM data, etc. 
│ ├── data/processed/           # Cleaned spatial and tabular data 
├── output/                     # Model objects, plots, tables 
├── results/                    # Final publication outputs 
├── reports/                    # Poster, slides, milestone logs 
├── to_check/                   # Temporary drafts 
├── FFA_regional-skew.Rproj 
├── README.Rmd                  # Workflow overview (editable)
├── README.md                   # Rendered Markdown output
└── .gitignore                  # Prevents sensitive/local files being pushed
```

## Getting Started

Run scripts in order within the `R/` folder. For example:

```   
source("R/01_download/01_get_spatial_data.R")
source("R/02_clean/03_filter_unregulated_gage_data.R")
```
All scripts assume R project is opened at the repository root (e.g., using .Rproj file).

---

## Reproducibility

This project uses:
- `.gitignore_spatial_template.txt` to exclude large geospatial files
- `git_commit_reference_card.txt` for consistent commit messages
- Modular milestone logs (see `reports/`) to track key development stages

## Reports and Milestone Logs

To explore the evolution of the project structure, covariate design, and documentation practices, see: 📁 [`reports/README.md`](reports/README.md) — Overview of all milestone logs, reference tools, and future plans


## Versioning

Tagged versions:
- **`v0.3-structure-refactor`** – Major restructure of project folders and files

